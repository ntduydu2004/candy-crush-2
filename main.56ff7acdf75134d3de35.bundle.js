(()=>{"use strict";var e,t={384:(e,t,i)=>{i(440);class s extends Phaser.Scene{constructor(){super({key:"BootScene"})}preload(){this.cameras.main.setBackgroundColor(10016391),this.createLoadingbar(),this.load.on("progress",(e=>{this.progressBar.clear(),this.progressBar.fillStyle(16774867,1),this.progressBar.fillRect(this.cameras.main.width/4,this.cameras.main.height/2-16,this.cameras.main.width/2*e,16)}),this),this.load.on("complete",(()=>{this.progressBar.destroy(),this.loadingBar.destroy()}),this),this.load.pack("preload","./assets/pack.json","preload")}update(){this.scene.start("GameScene")}createLoadingbar(){this.loadingBar=this.add.graphics(),this.loadingBar.fillStyle(6139463,1),this.loadingBar.fillRect(this.cameras.main.width/4-2,this.cameras.main.height/2-18,this.cameras.main.width/2+4,20),this.progressBar=this.add.graphics()}}let h={score:0,highscore:0,gridWidth:8,gridHeight:8,tileWidth:64,tileHeight:72,candyTypes:["blue-candy","green-candy","orange-candy","purple-candy","red-candy"],around:[{x:1,y:1},{x:0,y:1},{x:1,y:0},{x:-1,y:-1},{x:-1,y:0},{x:-1,y:1},{x:0,y:-1},{x:1,y:-1}]};class a{constructor(e,t){this.storage=[],this.returnObjectCallback=e,this.createObjectCallback=t}getObject(){let e=null;return e=this.storage.length>0?this.storage.pop():this.createObjectCallback(),e}returnObject(e){this.returnObjectCallback(e),this.storage.push(e)}}class r extends Phaser.GameObjects.Sprite{constructor(e){super(e.scene,e.x,e.y,e.texture,e.frame),this.tileNum=1,this.setOrigin(.5,.5),this.setInteractive(),this.setDepth(1),this.setScale(.8),this.scene.add.existing(this),this.greenFlame=this.scene.add.particles(0,0,"white",{color:[16119085,38916,38916,38916],colorEase:"quad.out",lifespan:600,angle:{min:-100,max:-80},scale:{start:1,end:0,ease:"sine.out"},speed:100,blendMode:"SCREEN"}).startFollow(this).stop().setDepth(0),this.blueFlame=this.scene.add.particles(0,0,"white",{color:[8481494,2442495],colorEase:"quad.out",lifespan:600,angle:{min:-100,max:-80},scale:{start:1,end:0,ease:"sine.out"},speed:100,blendMode:"SCREEN"}).startFollow(this).stop().setDepth(0),this.redFlame=this.scene.add.particles(0,0,"white",{color:[16667904,16649984],colorEase:"quad.out",lifespan:600,angle:{min:-100,max:-80},scale:{start:1,end:0,ease:"sine.out"},speed:100,blendMode:"SCREEN"}).startFollow(this).stop().setDepth(0)}stopFlame(){this.greenFlame.stop(),this.blueFlame.stop(),this.redFlame.stop()}setTileNumber(e){this.tileNum=e,this.stopFlame(),4==this.tileNum?this.greenFlame.start(20):5==this.tileNum?this.blueFlame.start(20):this.tileNum>5&&this.redFlame.start(20)}addTileNumber(e){this.tileNum+=e,this.stopFlame(),4==this.tileNum?this.greenFlame.start(20):5==this.tileNum?this.blueFlame.start(20):this.tileNum>5&&this.redFlame.start(20)}getTileNumber(){return this.tileNum}}var l;!function(e){e[e.NONE=0]="NONE",e[e.CIRCLE=1]="CIRCLE",e[e.SQUARE=2]="SQUARE",e[e.OCTAGON=3]="OCTAGON",e[e.TRIANGLE=4]="TRIANGLE",e[e.STAR=5]="STAR"}(l||(l={}));class n{constructor(){this.circle=new Phaser.Geom.Circle(250,300,200),this.square=new Phaser.Geom.Rectangle(50,100,400,400),this.triangle=new Phaser.Geom.Triangle(50,500,250,200,450,500),this.octagon=new Phaser.Curves.Path(150,100),this.octagon.lineTo(350,100),this.octagon.lineTo(450,200),this.octagon.lineTo(450,400),this.octagon.lineTo(350,500),this.octagon.lineTo(150,500),this.octagon.lineTo(50,400),this.octagon.lineTo(50,200),this.octagon.lineTo(150,100),this.star=new Phaser.Curves.Path(250,50);for(let e=0;e<5;e++){let t=Math.PI/2+2*Math.PI*e/5,i=250+200*Math.cos(t),s=250-200*Math.sin(t);this.star.lineTo(i,s),t+=Math.PI/5,i=250+95*Math.cos(t),s=250-95*Math.sin(t),this.star.lineTo(i,s)}this.star.closePath(),this.pathType=l.NONE,this.currentProgress=0}setPath(e){this.pathType=e}getPoints(e){switch(this.pathType){case l.CIRCLE:return this.circle.getPoints(e.length);case l.SQUARE:return this.square.getPoints(e.length);case l.TRIANGLE:return this.triangle.getPoints(e.length);case l.OCTAGON:{let t=1/e.length,i=[];for(let s=0;s<e.length;s++){let e=this.octagon.getPoint(t*s);i.push(new Phaser.Geom.Point(e.x,e.y))}return i}case l.STAR:{let t=1/e.length,i=[];for(let s=0;s<e.length;s++){let e=this.star.getPoint(t*s);i.push(new Phaser.Geom.Point(e.x,e.y))}return i}}return[]}update(e,t,i){if(this.pathType==l.NONE)return;this.currentProgress+=4e-4*i,this.currentProgress>=1&&(this.currentProgress-=1);let s=this.currentProgress,h=1/e.length;for(let t=0;t<e.length;t++){let i=s+t*h;switch(i>=1&&(i-=1),this.pathType){case l.CIRCLE:{const s=this.circle.getPoint(i);e[t].setPosition(s.x,s.y);break}case l.SQUARE:{const s=this.square.getPoint(i);e[t].setPosition(s.x,s.y);break}case l.OCTAGON:{const s=this.octagon.getPoint(i);e[t].setPosition(s.x,s.y);break}case l.TRIANGLE:{const s=this.triangle.getPoint(i);e[t].setPosition(s.x,s.y);break}case l.STAR:{const s=this.star.getPoint(i);e[t].setPosition(s.x,s.y);break}}}}}class o{constructor(e,t,i,s){this.activeTweens=0,this.scene=e,this.row=t,this.column=i,this.explosions=[],this.idleTileTween=[];for(let e=0;e<t;e++){this.explosions[e]=[];for(let t=0;t<i;t++)this.explosions[e][t]=this.scene.add.particles(0,0,"white_flare",{color:[16777141,16768966,16299697,16288160],colorEase:"sine.out",speed:100,lifespan:500,quantity:10,scale:{start:.2,end:0},emitting:!1,emitZone:{type:"edge",source:new Phaser.Geom.Circle(s[e][t].x,s[e][t].y,20),quantity:10},duration:200})}this.firstTileHint=this.scene.add.rectangle(0,0,h.tileWidth,h.tileHeight,16119085).setAlpha(0).setOrigin(.5).setDepth(-1),this.secondTileHint=this.scene.add.rectangle(0,0,h.tileWidth,h.tileHeight,16119085).setAlpha(0).setOrigin(.5).setDepth(-1),this.tileHintsTween=this.scene.add.tween({targets:[this.firstTileHint,this.secondTileHint],alpha:1,angle:360,scale:.7,yoyo:!0,repeat:-1,duration:1e3,ease:"back.out"}).pause(),this.leftConfetti=this.scene.add.particles(-50,600,"confetti",{frame:["1.png","2.png","3.png","4.png","5.png","6.png","7.png","8.png","9.png"],alpha:{min:75,max:100},lifespan:4e3,rotate:{onEmit:()=>Phaser.Math.RND.between(0,180),onUpdate:(e,t,i,s)=>s+3*i},angle:{min:-70,max:-35},speed:{onEmit:e=>{let t=2*-e.angle-600;return Phaser.Math.RND.between(t-500,t+200)}},scale:{start:.2,end:0},accelerationX:{onEmit:()=>-800,onUpdate:(e,t,i,s)=>e.velocityX>=100?-800:0},accelerationY:{onEmit:()=>800,onUpdate:(e,t,i,s)=>e.velocityY<=-100?800:0},quantity:1,gravityY:400,duration:2e3}).setDepth(5).stop(),this.rightConfetti=this.scene.add.particles(570,600,"confetti",{frame:["1.png","2.png","3.png","4.png","5.png","6.png","7.png","8.png","9.png"],alpha:{min:75,max:100},lifespan:4e3,rotate:{onEmit:()=>Phaser.Math.RND.between(0,180),onUpdate:(e,t,i,s)=>s+3*i},angle:{min:-145,max:-110},speed:{onEmit:e=>{let t=2*e.angle+800;return Phaser.Math.RND.between(t-200,t+500)}},scale:{start:.2,end:0},accelerationX:{onEmit:()=>800,onUpdate:(e,t,i,s)=>e.velocityX<=100?800:0},accelerationY:{onEmit:()=>800,onUpdate:(e,t,i,s)=>e.velocityY<=-100?800:0},quantity:1,gravityY:400,duration:2e3}).stop().setDepth(5),this.path=new n}setPath(e){this.path.setPath(e)}setPositionsOnPath(e){let t=this.path.getPoints(e);for(let i=0;i<e.length;i++)e[i].setDepth(1+.001*i),this.activeTweens++,this.scene.add.tween({targets:e[i],x:t[i].x,y:t[i].y,ease:"quad.out",duration:500,onComplete:()=>{this.activeTweens--}})}update(e,t,i){0==this.activeTweens&&this.path.update(e,t,i)}startSelectionTween(e){this.selectionTween&&!this.selectionTween.isDestroyed()&&this.selectionTween.destroy(),this.selectionTween=this.scene.add.tween({targets:e,duration:2e3,repeat:-1,angle:360,ease:"sine.out"})}removeSelectionTween(e){this.selectionTween.isPlaying()&&this.selectionTween.destroy(),this.scene.add.tween({targets:e,duration:100,ease:"linear",yoyo:!1,angle:0})}startConfettiEffect(){this.leftConfetti.start(),this.rightConfetti.start()}explode(e,t){this.explosions[t][e].start()}shake(){this.scene.cameras.main.shake(200,.03)}renderHint(e,t,i,s){this.firstTileHint.setPosition(e,t),this.secondTileHint.setPosition(i,s),this.tileHintsTween.restart()}removeHint(){this.tileHintsTween.isPlaying()&&this.tileHintsTween.pause(),this.firstTileHint.setAlpha(0),this.secondTileHint.setAlpha(0)}startIdleTileTween(e){this.idleTileTween=[];for(let t=0;t<this.row;t++){this.idleTileTween[t]=[];for(let i=0;i<this.column;i++)this.idleTileTween[t].push(this.scene.add.tween({targets:e[t][i],delay:50*(i+t),duration:300,scale:.4,repeat:-1,repeatDelay:5e3,yoyo:!0}))}}removeIdleTileTween(e){if(0!==this.idleTileTween.length)for(let t=0;t<this.row;t++)for(let i=0;i<this.column;i++)this.idleTileTween[t][i].isDestroyed()||(this.idleTileTween[t][i].destroy(),this.scene.add.tween({targets:e[t][i],scale:.8,duration:100,yoyo:!1,ease:"linear"}))}}class c extends Phaser.GameObjects.Container{constructor(e){super(e,260,650),this.progress=.1,this.scene.add.existing(this),this.barRect=this.scene.add.rectangle(0,0,500,30).setStrokeStyle(1,16777215),this.progressRect=this.scene.add.rectangle(0,0,496,26,6536190),this.particles=this.scene.add.particles(0,0,"white_flare",{lifespan:500,quantity:20,y:{min:-12,max:12},angle:{min:165,max:195},speed:{min:50,max:100},scale:{start:.1,end:0}}),this.add(this.barRect),this.add(this.progressRect),this.add(this.particles)}setProgress(e){this.progressRect.width=496*e,this.particles.x=this.progressRect.x-248+this.progressRect.width}}class d{constructor(e){this.scene=e,this.progressBar=new c(this.scene),this.reset()}reset(){this.score=0,this.scoreMax=Phaser.Math.RND.between(1e3,1e3),this.progressBar.setProgress(0)}addScore(e){this.score+=50*e,this.score=Math.min(this.score,this.scoreMax),this.progressBar.setProgress(this.score/this.scoreMax)}reachedMaxScore(){return this.score==this.scoreMax}}class f{constructor(e,t,i){this.tileDown=e=>{let t=Math.floor(e.y/h.tileHeight),i=Math.floor(e.x/h.tileWidth);if(this.canMove)if(this.firstSelectedTile){if(this.effectManager.removeSelectionTween(this.firstSelectedTile),this.firstSelectedTile===this.tileGrid[t][i])return void(this.firstSelectedTile=void 0);this.secondSelectedTile=this.tileGrid[t][i],Math.abs(this.firstSelectedTile.x-this.secondSelectedTile.x)/h.tileWidth+Math.abs(this.firstSelectedTile.y-this.secondSelectedTile.y)/h.tileHeight==1?(this.canMove=!1,this.scene.time.removeAllEvents(),this.effectManager.removeHint(),this.effectManager.removeIdleTileTween(this.tileGrid),this.swapTiles()):(this.firstSelectedTile=this.tileGrid[t][i],this.secondSelectedTile=void 0,this.effectManager.startSelectionTween(this.firstSelectedTile))}else this.firstSelectedTile=this.tileGrid[t][i],this.effectManager.startSelectionTween(this.firstSelectedTile)},this.scene=e,this.row=t,this.column=i,this.canMove=!0,this.isShaking=!1,this.scoreManager=new d(e),this.objectManager=new a((e=>{e.x=-100,e.y=-100,e.setTexture(""),e.setTileNumber(1),e.stopFlame()}),(()=>new r({scene:this.scene,x:-100,y:-100,texture:""}))),this.tilesArr=[],this.tileGrid=[],this.visited=new Array(this.row).fill(null).map((()=>new Array(this.column).fill(!1)));for(let e=0;e<t;e++){this.tileGrid[e]=[];for(let t=0;t<i;t++)this.tileGrid[e][t]=this.createTile(t,e)}this.effectManager=new o(e,t,i,this.tileGrid),this.firstSelectedTile=void 0,this.secondSelectedTile=void 0,this.scene.input.on("gameobjectdown",this.tileDown),this.checkMatches()}update(e,t){this.effectManager.update(this.tilesArr,e,t)}celebrate(){this.scene.time.removeAllEvents(),this.effectManager.removeHint(),this.effectManager.removeIdleTileTween(this.tileGrid),this.getShuffledTileArray(),this.effectManager.setPath(Phaser.Math.RND.between(1,5)),this.effectManager.setPositionsOnPath(this.tilesArr),this.effectManager.startConfettiEffect(),this.scene.time.delayedCall(5e3,(()=>{this.effectManager.setPath(l.NONE),this.returnToInitialPosition()}))}returnToInitialPosition(){this.scoreManager.reset();for(let e=0;e<this.row;e++)for(let t=0;t<this.column;t++)this.scene.add.tween({targets:this.tileGrid[e][t],x:t*h.tileWidth+h.tileWidth/2,y:e*h.tileHeight+h.tileHeight/2,ease:"expo.inout",delay:5*(e*this.column+t),duration:500});this.checkMatches()}releaseTile(e){this.objectManager.returnObject(e)}checkValid(e,t){return 0<=e&&e<this.column&&0<=t&&t<this.row&&void 0!==this.tileGrid[t][e]&&!this.visited[t][e]}createTile(e,t){let i=h.candyTypes[Phaser.Math.RND.between(0,h.candyTypes.length-1)],s=this.objectManager.getObject();return s.setPosition(e*h.tileWidth+h.tileWidth/2,t*h.tileHeight+h.tileHeight/2),s.setTexture(i),s}renderHint(){const e=this.getHints();let t=this.tileGrid[e.firstY][e.firstX].x,i=this.tileGrid[e.firstY][e.firstX].y,s=this.tileGrid[e.secondY][e.secondX].x,h=this.tileGrid[e.secondY][e.secondX].y;this.effectManager.renderHint(t,i,s,h)}getHints(){let e=[];for(let t=0;t<this.row;t++)for(let i=0;i<this.column;i++){let s=this.tileGrid[t][i].texture.key;this.visited[t][i]=!0,this.checkExistMatch(i+1,t,s)&&e.push({firstX:i,firstY:t,secondX:i+1,secondY:t}),this.checkExistMatch(i-1,t,s)&&e.push({firstX:i,firstY:t,secondX:i-1,secondY:t}),this.checkExistMatch(i,t+1,s)&&e.push({firstX:i,firstY:t,secondX:i,secondY:t+1}),this.checkExistMatch(i,t-1,s)&&e.push({firstX:i,firstY:t,secondX:i,secondY:t-1}),this.visited[t][i]=!1}return 0==e.length?{firstX:-1,firstY:-1,secondX:-1,secondY:-1}:e[Phaser.Math.RND.between(0,e.length-1)]}getShuffledTileArray(){this.tilesArr=[];for(let e=0;e<this.row;e++)for(let t=0;t<this.column;t++)this.tilesArr.push(this.tileGrid[e][t]);this.tilesArr.sort((()=>Math.random()-.5))}checkExistMatch(e,t,i){if(!this.checkValid(e,t))return!1;let s=1;for(let h=e-1;h>=0&&this.checkValid(h,t)&&this.tileGrid[t][h].texture.key===i;h--)s++;for(let h=e+1;h<this.column&&this.checkValid(h,t)&&this.tileGrid[t][h].texture.key===i;h++)s++;if(s>=3)return!0;s=1;for(let h=t-1;h>=0&&this.checkValid(e,h)&&this.tileGrid[h][e].texture.key===i;h--)s++;for(let h=t+1;h<this.row&&this.checkValid(e,h)&&this.tileGrid[h][e].texture.key===i;h++)s++;return s>=3}swapTiles(){if(this.firstSelectedTile&&this.secondSelectedTile){let e={x:this.firstSelectedTile.x,y:this.firstSelectedTile.y},t={x:this.secondSelectedTile.x,y:this.secondSelectedTile.y};this.tileGrid[(e.y-h.tileHeight/2)/h.tileHeight][(e.x-h.tileWidth/2)/h.tileWidth]=this.secondSelectedTile,this.tileGrid[(t.y-h.tileHeight/2)/h.tileHeight][(t.x-h.tileWidth/2)/h.tileWidth]=this.firstSelectedTile,this.scene.add.tween({targets:this.firstSelectedTile,x:this.secondSelectedTile.x,y:this.secondSelectedTile.y,ease:"expo.inout",duration:400,repeat:0,yoyo:!1}),this.scene.add.tween({targets:this.secondSelectedTile,x:this.firstSelectedTile.x,y:this.firstSelectedTile.y,ease:"expo.inout",duration:400,repeat:0,yoyo:!1,onComplete:()=>{this.checkMatches()}}),this.firstSelectedTile=this.tileGrid[(e.y-h.tileHeight/2)/h.tileHeight][(e.x-h.tileWidth/2)/h.tileWidth],this.secondSelectedTile=this.tileGrid[(t.y-h.tileHeight/2)/h.tileHeight][(t.x-h.tileWidth/2)/h.tileWidth]}}fillTiles(){let e=0;for(let t=0;t<this.column;t++){let i=0;for(let e=this.row-1;e>=0;e--){if(void 0===this.tileGrid[e][t]){i++;continue}let s=this.tileGrid[e][t];this.tileGrid[e][t]=void 0,this.tileGrid[e+i][t]=s,this.effectManager.activeTweens++,this.scene.add.tween({targets:s,y:(e+i)*h.tileHeight+h.tileHeight/2,ease:"bounce",duration:400,delay:100,onComplete:()=>{this.effectManager.activeTweens--,0==this.effectManager.activeTweens&&this.checkMatches()}})}for(let e=-1;e>=-i;e--){let s=this.createTile(t,e);this.tileGrid[e+i][t]=s,this.effectManager.activeTweens++,this.scene.add.tween({targets:s,y:(e+i)*h.tileHeight+h.tileHeight/2,ease:"bounce",duration:400,repeat:0,delay:100,yoyo:!1,onComplete:()=>{this.effectManager.activeTweens--,0==this.effectManager.activeTweens&&this.checkMatches()}})}e+=i}this.tileUp()}tileUp(){this.firstSelectedTile=void 0,this.secondSelectedTile=void 0}handleExplosionChain(e,t){let i=this.tileGrid[t][e].getTileNumber(),s=this.tileGrid[t][e].texture.key;if(this.scoreManager.addScore(i),this.tileGrid[t][e]=void 0,1!=i)if(this.isShaking=!0,4==i)for(let i=0;i<8;i++){let s=t+h.around[i].y,a=e+h.around[i].x;if(!this.checkValid(a,s))continue;let r=this.tileGrid[s][a];this.effectManager.activeTweens++,this.scene.add.tween({targets:r,duration:200,onComplete:()=>{this.effectManager.explode(a,s),this.effectManager.activeTweens--,this.releaseTile(r),0==this.effectManager.activeTweens&&(this.isShaking&&(this.effectManager.shake(),this.isShaking=!1),this.fillTiles())}}),this.visited[s][a]=!0,this.handleExplosionChain(a,s)}else if(5==i){for(let t=0;t<this.row;t++){if(!this.checkValid(e,t))continue;let i=this.tileGrid[t][e];this.effectManager.activeTweens++,this.scene.add.tween({targets:i,duration:200,onComplete:()=>{this.effectManager.explode(e,t),this.effectManager.activeTweens--,this.releaseTile(i),0==this.effectManager.activeTweens&&(this.isShaking&&(this.effectManager.shake(),this.isShaking=!1),this.fillTiles())}}),this.visited[t][e]=!0,this.handleExplosionChain(e,t)}for(let e=0;e<this.column;e++){if(!this.checkValid(e,t))continue;let s=this.tileGrid[t][e];this.effectManager.activeTweens++,this.scene.add.tween({targets:i,duration:200,onComplete:()=>{this.effectManager.explode(e,t),this.effectManager.activeTweens--,this.releaseTile(s),0==this.effectManager.activeTweens&&(this.isShaking&&(this.effectManager.shake(),this.isShaking=!1),this.fillTiles())}}),this.visited[t][e]=!0,this.handleExplosionChain(e,t)}}else if(i>=6)for(let e=0;e<this.row;e++)for(let t=0;t<this.column;t++)if(this.checkValid(t,e)&&s===this.tileGrid[e][t].texture.key){let i=this.tileGrid[e][t];this.tileGrid[e][t]=void 0,this.effectManager.activeTweens++,this.scene.add.tween({targets:i,duration:200,onComplete:()=>{this.effectManager.explode(t,e),this.effectManager.activeTweens--,this.releaseTile(i),0==this.effectManager.activeTweens&&(this.isShaking&&(this.effectManager.shake(),this.isShaking=!1),this.fillTiles())}}),this.visited[e][t]=!0}}checkMatches(){for(let e=0;e<this.row;e++)for(let t=0;t<this.column;t++)this.visited[e][t]=!1;for(let e=0;e<this.row;e++)for(let t=0;t<this.column;t++){if(!this.checkValid(t,e))continue;let i=0,s=0,a=[],r=t-1;for(;this.checkValid(r,e)&&this.tileGrid[e][r].texture.key===this.tileGrid[e][t].texture.key;)i++,a.push(this.tileGrid[e][r]),r--;for(r=t+1;this.checkValid(r,e)&&this.tileGrid[e][r].texture.key===this.tileGrid[e][t].texture.key;)i++,a.push(this.tileGrid[e][r]),r++;if(i<2)continue;for(r=e-1;this.checkValid(t,r)&&this.tileGrid[r][t].texture.key===this.tileGrid[e][t].texture.key;)s++,a.push(this.tileGrid[r][t]),r--;for(r=e+1;this.checkValid(t,r)&&this.tileGrid[r][t].texture.key===this.tileGrid[e][t].texture.key;)s++,a.push(this.tileGrid[r][t]),r++;if(s<2)continue;let l=0;for(let i=0;i<a.length;i++){let s=a[i];l+=s.getTileNumber();let r=(s.x-h.tileWidth/2)/h.tileWidth,n=(s.y-h.tileHeight/2)/h.tileHeight;this.effectManager.activeTweens++,this.scene.add.tween({targets:s,duration:200,x:t*h.tileWidth+h.tileWidth/2,y:e*h.tileHeight+h.tileHeight/2,ease:"linear",onComplete:()=>{this.effectManager.activeTweens--,this.releaseTile(s),0==this.effectManager.activeTweens&&this.fillTiles()}}),this.tileGrid[n][r]=void 0,this.visited[n][r]=!0}this.tileGrid[e][t].addTileNumber(l)}for(let e=0;e<this.row;e++)for(let t=0;t<this.column;t++){if(!this.checkValid(t,e))continue;let i=0,s=t;for(let h=t;h<this.column&&this.checkValid(h,e)&&this.tileGrid[e][t].texture.key===this.tileGrid[e][h].texture.key;h++)i++,this.tileGrid[e][h]!==this.firstSelectedTile&&this.tileGrid[e][h]!==this.secondSelectedTile||(s=h);if(3==i)for(let i=t;i<t+3;i++){if(!this.checkValid(i,e))continue;let t=this.tileGrid[e][i];this.effectManager.activeTweens++,this.scene.add.tween({targets:t,duration:200,onComplete:()=>{this.effectManager.explode(i,e),this.effectManager.activeTweens--,this.releaseTile(t),0==this.effectManager.activeTweens&&(this.isShaking&&(this.effectManager.shake(),this.isShaking=!1),this.fillTiles())}}),this.visited[e][i]=!0,this.handleExplosionChain(i,e)}else if(i>3){let a=0;for(let r=t;r<t+i;r++){if(r==s)continue;let t=this.tileGrid[e][r];a+=t.getTileNumber(),this.tileGrid[e][r]=void 0,this.effectManager.activeTweens++,this.scene.add.tween({targets:t,ease:"quad.out",duration:200,x:s*h.tileWidth+h.tileWidth/2,repeat:0,yoyo:!1,delay:100,onComplete:()=>{this.effectManager.activeTweens--,this.releaseTile(t),0==this.effectManager.activeTweens&&(this.isShaking&&(this.effectManager.shake(),this.isShaking=!1),this.fillTiles())}})}this.tileGrid[e][s].addTileNumber(a)}}for(let e=0;e<this.column;e++)for(let t=0;t<this.row;t++){if(!this.checkValid(e,t))continue;let i=0,s=t;for(let h=t;h<this.row&&this.checkValid(e,h)&&this.tileGrid[t][e].texture.key===this.tileGrid[h][e].texture.key;h++)i++,this.tileGrid[h][e]!==this.firstSelectedTile&&this.tileGrid[h][e]!==this.secondSelectedTile||(s=h);if(3==i)for(let i=t;i<t+3;i++){if(!this.checkValid(e,i))continue;let t=this.tileGrid[i][e];this.effectManager.activeTweens++,this.scene.add.tween({targets:t,duration:200,onComplete:()=>{this.effectManager.explode(e,i),this.releaseTile(t),this.effectManager.activeTweens--,0==this.effectManager.activeTweens&&(this.isShaking&&(this.effectManager.shake(),this.isShaking=!1),this.fillTiles())}}),this.visited[i][e]=!0,this.handleExplosionChain(e,i)}else if(i>3){let a=0;for(let r=t;r<t+i;r++){if(r==s)continue;let t=this.tileGrid[r][e];a+=t.getTileNumber(),this.tileGrid[r][e]=void 0,this.effectManager.activeTweens++,this.scene.add.tween({targets:t,ease:"quad.out",duration:200,y:s*h.tileHeight+h.tileHeight/2,repeat:0,yoyo:!1,delay:100,onComplete:()=>{this.effectManager.activeTweens--,this.releaseTile(t),0==this.effectManager.activeTweens&&(this.isShaking&&(this.effectManager.shake(),this.isShaking=!1),this.fillTiles())}})}this.tileGrid[s][e].addTileNumber(a)}}if(0==this.effectManager.activeTweens){if(!this.firstSelectedTile&&!this.secondSelectedTile){if(this.scoreManager.reachedMaxScore())return void this.celebrate();this.scene.time.delayedCall(3e3,(()=>{this.renderHint()})),this.scene.time.delayedCall(3e3,(()=>{this.effectManager.startIdleTileTween(this.tileGrid)}))}this.swapTiles(),this.tileUp(),this.canMove=!0}}}class g extends Phaser.Scene{constructor(){super({key:"GameScene"})}init(){this.background=this.add.sprite(0,0,"background").setDepth(-2).setOrigin(0).setScale(.9),this.backgroundAlpha=this.add.rectangle(0,0,1e3,1e3,0).setDepth(-1.5).setAlpha(.8).setOrigin(0),this.playingZone=this.add.zone(0,0,h.gridWidth*h.tileWidth,h.gridHeight*h.tileHeight).setDepth(1).setInteractive(),this.tileGrid=new f(this,h.gridHeight,h.gridWidth)}update(e,t){this.tileGrid.update(e,t)}}const u={title:"Candy crush",url:"https://github.com/digitsensitive/phaser3-typescript",version:"0.0.1",width:520,height:700,type:Phaser.AUTO,scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},parent:"game",scene:[s,g],backgroundColor:"#de3412",render:{pixelArt:!1,antialias:!0}};class p extends Phaser.Game{constructor(e){super(e)}}window.addEventListener("load",(()=>{new p(u)}))}},i={};function s(e){var h=i[e];if(void 0!==h)return h.exports;var a=i[e]={exports:{}};return t[e].call(a.exports,a,a.exports,s),a.exports}s.m=t,e=[],s.O=(t,i,h,a)=>{if(!i){var r=1/0;for(c=0;c<e.length;c++){for(var[i,h,a]=e[c],l=!0,n=0;n<i.length;n++)(!1&a||r>=a)&&Object.keys(s.O).every((e=>s.O[e](i[n])))?i.splice(n--,1):(l=!1,a<r&&(r=a));if(l){e.splice(c--,1);var o=h();void 0!==o&&(t=o)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[i,h,a]},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={792:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var h,a,[r,l,n]=i,o=0;if(r.some((t=>0!==e[t]))){for(h in l)s.o(l,h)&&(s.m[h]=l[h]);if(n)var c=n(s)}for(t&&t(i);o<r.length;o++)a=r[o],s.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return s.O(c)},i=self.webpackChunktype_project_template=self.webpackChunktype_project_template||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var h=s.O(void 0,[96],(()=>s(384)));h=s.O(h)})();